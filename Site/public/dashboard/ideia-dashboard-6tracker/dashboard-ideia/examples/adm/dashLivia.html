<!--
=========================================================
* Paper Dashboard 2 - v2.0.1
=========================================================

* Product Page: https://www.creative-tim.com/product/paper-dashboard-2
* Copyright 2020 Creative Tim (https://www.creative-tim.com)

Coded by www.creative-tim.com fdp chris

 =========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="76x76" href="../../assets/img/6Tracker/logo-sf-vertical-preta.png">
  <link rel="icon" type="image/png" href="../../assets/img/6Tracker/logo-sf-vertical-preta.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>
    Dashboard
  </title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
    name='viewport' />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
  <!-- CSS Files -->
  <link href="../../assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="../../assets/css/dashboardPlane.css" rel="stylesheet" />
  <!-- CSS Just for demo purpose, don't include it in your project -->
  <link href="../../assets/demo/demo.css" rel="stylesheet" />
</head>

<body onload="plotarGraficoConexao()">

  <div class="wrapper ">
    <div class="sidebar" data-color="white" data-active-color="danger">
      <div class="logo">
        <a href="./principalDashAdm.html" class="simple-text logo-mini">
          <div class="logo-image-small">
            <img src="../../assets/img/6Tracker/logo-sf-vertical-preta.png">
          </div>
          <!-- <p>CT</p> -->
        </a>
        <a href="./principalDashAdm.html" class="simple-text logo-normal">
          6Tracker
          <!-- <div class="logo-image-big">
            <img src="../assets/img/logo-big.png">
          </div> -->
        </a>
      </div>
      <div class="sidebar-wrapper">
        <ul class="nav">
          <li>
            <a href="./principalDashAdm.html">
              <i class="nc-icon nc-layout-11"></i>
              <p>Dashboard - principal</p>
            </a>
          </li>
          <li>
            <a href="./dashGui.html">
              <i class="nc-icon nc-layout-11"></i>
              <p>Dashboard CPU e RAM</p>
            </a>
          </li>
          <li class="active ">
            <a href="./dashLivia.html">
              <i class="nc-icon nc-layout-11"></i>
              <p>Dashboard - Lívia</p>
            </a>
          </li>
          <li>
            <a href="./dashTiago.html">
              <i class="nc-icon nc-layout-11"></i>
              <p>Dashboard - Tiago</p>
            </a>
          </li>

          <li>
            <a href="./addSala.html">
              <i class="nc-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                  class="bi bi-plus-circle" viewBox="0 0 16 16">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                  <path
                    d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                </svg>
              </i>
              <p>Add Salas</p>
            </a>
          </li>

          <li>
            <a href="./addServidor.html">
              <i class="nc-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                  class="bi bi-plus-circle" viewBox="0 0 16 16">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                  <path
                    d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                </svg>
              </i>
              <p>Add servidor</p>
            </a>
          </li>
          <li>
            <a href="./addComponente.html">
              <i class="nc-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                  class="bi bi-plus-circle" viewBox="0 0 16 16">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                  <path
                    d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                </svg>
              </i>
              <p>Add componentes</p>
            </a>
          </li>

          <li>
            <a href="./addUser.html">
              <i class="nc-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                  class="bi bi-person-add" viewBox="0 0 16 16">
                  <path
                    d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0Zm-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" />
                  <path
                    d="M8.256 14a4.474 4.474 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10c.26 0 .507.009.74.025.226-.341.496-.65.804-.918C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4s1 1 1 1h5.256Z" />
                </svg>
              </i>
              <p>Adicionar usuários</p>
            </a>
          </li>

          <li>
            <a href="./tables.html">
              <i class="nc-icon nc-tile-56"></i>
              <p>Lista geral</p>
            </a>
          </li>
          <li>
            <a href="../inicioAdm/sininho.html">
              <i class="nc-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                  class="bi bi-arrow-left-circle" viewBox="0 0 16 16">
                  <path fill-rule="evenodd"
                    d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8zm15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z" />
                </svg>
              </i>
              <p>Voltar</p>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-absolute fixed-top navbar-transparent">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <div class="navbar-toggle">
              <button type="button" class="navbar-toggler">
                <span class="navbar-toggler-bar bar1"></span>
                <span class="navbar-toggler-bar bar2"></span>
                <span class="navbar-toggler-bar bar3"></span>
              </button>
            </div>
            <a class="navbar-brand" href="javascript:;">Dashboard Administrador</a>
          </div>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
            aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end" id="navigation">
            <form>
              <div class="input-group no-border">
                <input type="text" value="" class="form-control" placeholder="Search...">
                <div class="input-group-append">
                  <div class="input-group-text">
                    <i class="nc-icon nc-zoom-split"></i>
                  </div>
                </div>
              </div>
            </form>
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link btn-magnify" href="javascript:;">
                  <i class="nc-icon nc-layout-11"></i>
                  <p>
                    <span class="d-lg-none d-md-block">Stats</span>
                  </p>
                </a>
              </li>
              <li class="nav-item btn-rotate dropdown">
                <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink"
                  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="nc-icon nc-bell-55"></i>
                  <p>
                    <span class="d-lg-none d-md-block">Some Actions</span>
                  </p>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                  <a class="dropdown-item" href="../inicioAdm/sininho.html">Notificação</a>
                  <a class="dropdown-item" href="#">Ajuda - Jira</a>
                  <a class="dropdown-item" href="#">Comunicação - Slack</a>
                </div>
              </li>
              <li class="nav-item">
                <a class="nav-link btn-rotate" href="javascript:;">
                  <i class="nc-icon nc-settings-gear-65"></i>
                  <p>
                    <span class="d-lg-none d-md-block">Account</span>
                  </p>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->
      <div class="content">
        <div class="row" id="card-list">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                <h4 class="card-title">Conexões de USB passadas</h4>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table">
                    <thead class=" text-primary">
                    </thead>
                    <tbody id="tabelaUSB">
                      <tr>
                        <th>
                          Horário de Conexão
                        </th>
                        <th>
                          Horário de Desconexão
                        </th>
                        <th>
                          Servidor
                        </th>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <canvas id="meuGrafico" width="400" height="150"></canvas>
          <!-- <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                <h4 class="card-title"> Lista componentes</h4>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table">
                    <thead class=" text-primary">


                    </thead>
                    <tbody id="tabelaComponente">
                      <tr>
                        <th>
                          Nome componente
                        </th>
                        <th>
                          Código
                        </th>
                      </tr>
                      <tr>
                        <td>
                          Disco
                        </td>
                        <td>
                          SDF456
                        </td>

                      </tr>
                      <tr>
                        <td>
                          Memória RAM
                        </td>
                        <td>
                          KJP45D
                        </td>

                      </tr>
                      <tr>
                        <td>
                          CPU
                        </td>
                        <td>
                          JHFSD5
                        </td>

                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>-->
        </div>

        <footer class="footer footer-black  footer-white ">
          <div class="container-fluid">
            <div class="row">
              <nav class="footer-nav">
                <ul>
                  <li><a href="./principalDashAdm.html" target="_blank">Suporte</a></li>
                  <li><a href="./principalDashAdm.html/blog" target="_blank">Comunicação</a></li>
                  <li><a href="./principalDashAdm.html/license" target="_blank">Site institucional</a></li>
                </ul>
              </nav>
              <div class="credits ml-auto">
                <span class="copyright">
                  ©
                  <script>
                    document.write(new Date().getFullYear())
                  </script>, made with 6Tracker.
                </span>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>
    <!--   Core JS Files   -->
    <!-- <script src="../../assets/js/core/jquery.min.js"></script> -->
    <!-- <script src="../../assets/js/core/popper.min.js"></script> -->
    <!-- <script src="../../assets/js/core/bootstrap.min.js"></script> -->
    <!-- <script src="../../assets/js/plugins/perfect-scrollbar.jquery.min.js"></script> -->
    <!--  Google Maps Plugin    -->
    <!-- <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script> -->
    <!-- Chart JS -->
    <!-- <script src="../../assets/js/plugins/chartjs.min.js"></script> -->
    <!--  Notifications Plugin    -->
    <!-- <script src="../../assets/js/plugins/bootstrap-notify.js"></script> -->
    <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
    <!-- <script src="../../assets/js/paper-dashboard.min.js?v=2.0.1" type="text/javascript"></script> -->
    <!-- Paper Dashboard DEMO methods, don't include it in your project! -->
    <!-- <script src="../../assets/js/graficoAdm/grafAdm.js"></script> -->
    <script src="../../assets/js/grafLivia.js"></script>

    <script>
      // $(document).ready(function () {
      //   // Javascript method's body can be found in assets/assets-for-demo/js/demo.js
      //   demo.initChartsPages();
      // });
    </script>
</body>

</html>
<script>


function obterDadosConectado() {
  var existingChart = Chart.getChart('myChart')
  if (existingChart) {
    existingChart.destroy()
    console.log('o grafico existente foi destruído')
  }
  return fetch(`/graficosLivia/medidasConectado/`, { cache: 'no-store' })
    .then(response => {
      if (response.ok) {
        return response.json();
      } else {
        throw new Error('Nenhum dado encontrado ou erro na API');
      }
    })
    .then(resposta => {
      console.log(`Dados recebidos DE USB: ${JSON.stringify(resposta)}`);
      resposta.reverse();
      console.log(resposta);
      return resposta
    })
    .catch(error => {
      console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      throw error;
    });
}

function obterDadosDesconectado() {
  var existingChart = Chart.getChart('myChart')
  if (existingChart) {
    existingChart.destroy()
    console.log('o grafico existente foi destruído')
  }
  return fetch(`/graficosLivia/medidasDesconectado/`, { cache: 'no-store' })
    .then(response => {
      if (response.ok) {
        return response.json();
      } else {
        throw new Error('Nenhum dado encontrado ou erro na API');
      }
    })
    .then(resposta => {
      console.log(`Dados recebidos DE USB: ${JSON.stringify(resposta)}`);
      resposta.reverse();
      console.log(resposta);
      return resposta
    })
    .catch(error => {
      console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      throw error;
    });
}

function obterDadosParaGrafico() {
  var existingChart = Chart.getChart('myChart')
  if (existingChart) {
    existingChart.destroy()
    console.log('o grafico existente foi destruído')
  }
  Promise.all([obterDadosConectado(), obterDadosDesconectado()])
    .then(resultados => {
      const [conectado, desconectado] = resultados;
      plotarGraficoConexao(conectado, desconectado);
    })
    .catch(error => {
      console.error(`Erro ao obter dados para o gráfico: ${error.message}`);
    });
}

function plotarGraficoConexao(conectado, desconectado) {
  var ctx = document.getElementById('meuGrafico').getContext('2d');
  var data = {
    labels: ['Conectado', 'Desconectado'],
    datasets: [
      {
        label: 'Estado das Conexões',
        data: [conectado, desconectado],
        backgroundColor: [
          'rgba(255, 99, 132, 0.8)',
          'rgba(54, 162, 235, 0.8)'
        ],
        borderColor: [
          'rgba(255, 99, 132, 1)',
          'rgba(54, 162, 235, 1)'
        ],
        borderWidth: 1
      }
    ]
  };

  var myChart = new Chart(ctx, {
    type: 'doughnut',
    data: data,
    options: {
      cutout: '70%',
      responsive: true,
      maintainAspectRatio: false,
      legend: {
        position: 'bottom'
      },
      title: {
        display: true,
        text: 'Estado das Conexões USB'
      }
    }
  });
}


// Chamando a função para obter os dados e plotar o gráfico
obterDadosParaGrafico();




  // var conectado = ""
  // var desconectado = ""
  // function obterDadosConectado() {
  //   console.log("Conectado")

  //   fetch(`/graficosLivia/medidasConectado/`, { cache: 'no-store' }).then(function (response) {
  //     if (response.ok) {
  //       response.json().then(function (resposta) {
  //         console.log(`Dados recebidos DE USB: ${JSON.stringify(resposta)}`);
  //         resposta1.reverse();
  //         for (var i = 0; i < json.length; i++) {
  //           conectado.push(json[i].valorRegistro)
  //         }
  //         console.log(resposta)
  //         plotarGraficoConexao(resposta);

  //       });
  //     } else {
  //       console.error('Nenhum dado encontrado ou erro na API');
  //     }
  //   })
  //     .catch(function (error) {
  //       console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
  //     });
  // }

  // function obterDadosDesconectado() {
  //   console.log("Desconectado")

  //   fetch(`/graficosLivia/medidasDesconectado/`, { cache: 'no-store' }).then(function (response) {
  //     if (response.ok) {
  //       response.json().then(function (resposta) {
  //         console.log(`Dados recebidos DE USB: ${JSON.stringify(resposta)}`);
  //         resposta2.reverse();
  //         for (var i = 0; i < json.length; i++) {
  //           desconectado.push(json[i].valorRegistro)
  //         }

  //         console.log(resposta)
  //         plotarGraficoConexao(resposta);

  //       });
  //     } else {
  //       console.error('Nenhum dado encontrado ou erro na API');
  //     }
  //   })
  //     .catch(function (error) {
  //       console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
  //     });
  // }



  // function plotarGraficoConexao(conectada , desconectada) {

  //   var ctx = document.getElementById('meuGrafico').getContext('2d');

  //   var data = {
  //     labels: ['Conectado', 'Desconectado'],
  //     datasets: [{
  //       label: 'Estado das conexões',
  //       data: [conectada , desconectada], // Substitua esses valores pelos seus dados
  //       backgroundColor: [
  //         'rgba(255, 99, 135, 1)',
  //         'rgb(69, 7, 156)',
  //       ],
  //       borderColor: [
  //         'rgba(255, 99, 135, 0.5)',
  //         'rgba(69, 7, 156, 0.5)',
  //       ],
  //       borderWidth: 1
  //     }]
  //   };

  //   var meuGrafico = new Chart(ctx, {
  //     type: 'doughnut',
  //     data: data,
  //     options: {
  //       cutout: '90%'

  //     }
  //   });
  // }


  // function atualizarGrafico() {
  //       setInterval(() => {
  //         obterDadosConectado()
  //         obterDadosDesconectado()

  //         meuGrafico.data.datasets[0] = conectado
  //         meuGrafico.data.datasets[1] = desconectado

  //         liviaGrafico.update()
  //       },5000)
  //     }
      


  var fkServidor = 2

// Função para buscar usuários do banco de dados  
fetch("/graficosLivia/buscarUSB/", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      // crie um atributo que recebe o valor recuperado aqui
      // Agora vá para o arquivo routes/usuario.js
      fkServidorServer: fkServidor,
    })
  })
    .then(response => response.json())
    .then(data => {
      // Limpa o conteúdo atual da tabela
      const tabelaUSB = document.getElementById('tabelaUSB');
      

      // Itera sobre os dados do banco de dados e adiciona ao tbody
      data.forEach(usb => {
        const row = tabelaUSB.insertRow();
        const cellInicial = row.insertCell(0);
        const cellFinal = row.insertCell(1);
        const cellServidor = row.insertCell(2);

        cellInicial.textContent = usb.dataInicio;
        cellFinal.textContent = usb.dataFinal;
        cellServidor.textContent = usb.nome;
      });
    })
    .catch(error => console.error('Erro ao buscar usb:', error));


// Chama a função ao carregar a página
document.addEventListener('DOMContentLoaded', buscarUSB);

</script>